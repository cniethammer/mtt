[MTTDefaults]
scratchdir = /users/XXX/mtt/scratch
description = OpenMPI main
platform = platform_foobar
executor = sequential

[Profile:Installed]

#======================================================================
# Middleware construction phases - get the middleware, build, and
# install it. This isn't a required phase - if the purpose of this test
# is to simply stress the physical system, then one can skip this phase
#======================================================================

[MiddlewareGet:OMPIMain]
plugin = OMPI_Snapshot
url =  https://download.open-mpi.org/nightly/open-mpi/main
version_file = /users/XXX/mtt/vf_main
mpi_name = ompi-nightly-main

#----------------------------------------------------------------------

[MiddlewareBuild:OMPIMain]
parent = MiddlewareGet:OMPIMain
plugin = Autotools
configure_options = --with-ofi
make_options = -j 8
checkpoint_file = /users/XXX/mtt/scratch/ompi_logfile_checkpoint

#======================================================================
# Test construction phases - get and build the tests that the
# target software will run.
#======================================================================

[TestGet:IBM]
plugin = Copytree
src = /users/XXX/ompi-tests-for-mtt/ibm
parent = MiddlewareBuild:OMPIMain


#======================================================================
# Test build phase
#======================================================================

[TestBuild:IBMInstalled]
parent = TestGet:IBM
merge_stdout_stderr = 1
stderr_save_lines = 100
middleware = MiddlewareBuild:OMPIMain
autogen_cmd = ./autogen.sh
configure_options = CC=mpicc CXX=mpic++ F77=mpif77 FC=mpifort
make_options = -j 4
checkpoint_file = /users/XXX/mtt/main_scratch/ompi_logfile_checkpoint

